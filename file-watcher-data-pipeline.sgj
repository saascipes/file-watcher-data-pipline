{"jobDefs":[{"version":"0.0","name":"File Analyzer","maxInstances":1,"pauseOnJobFail":false,"runtimeVars":{},"schedules":[{"TriggerType":"cron","name":"hourly","isActive":false,"cron":{"Timezone":"America/Denver","Minute":"1"},"interval":{}}],"taskDefs":[{"target":4,"name":"Analyze file","requiredTags":{"task":"file_analyzer"},"fromRoutes":[],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"download file","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"","lambdaMemorySize":128,"lambdaTimeout":3,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"","lambdaZipfile":"","scriptName":"DownloadS3File.sh"},{"name":"analyze file","order":2,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"","lambdaMemorySize":128,"lambdaTimeout":3,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"","lambdaZipfile":"","scriptName":"RunWordCount.sh"}],"exportWarnings":[]}]},{"version":"0.0","name":"File Watcher","maxInstances":1,"misFireGraceTime":null,"coalesce":null,"pauseOnJobFail":false,"runtimeVars":{"instanceNameTag":"*","NumInstances":"*","ImageId":"*","sgAPIAccessKeySecret":"*","sgAPIAccessKeyId":"*","s3Prefix":"*","s3Bucket":"*","jobDefId":"*","workingdir":"*","tags":"*","maxAgentTasks":"*","inactivePeriodWaitTime":"*","agentBuilderScaleFactor":"*","VpcId":"*","SubnetId":"*","SecurityGroupIds":"*","KeyName":"*","InstanceType":"*","InactiveAgentJobId":"*","IAMRole":"*","stopAgentAPIAccessKeySecret":"*","stopAgentAPIAccessKeyId":"*","agentAccessKeySecret":"*","agentAccessKeyId":"*","agentDownloadAccessKeyId":"*","agentDownloadAccessKeySecret":"*"},"schedules":[],"taskDefs":[{"target":32,"name":"Check for new files","requiredTags":{},"fromRoutes":[],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"AwsLambda","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"nodejs10.x","lambdaMemorySize":128,"lambdaTimeout":30,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"aws-sdk","lambdaZipfile":"","scriptName":"S3FileWatcher.js"}],"exportWarnings":[]},{"target":32,"name":"Launch analyzer host","requiredTags":{},"fromRoutes":[["Check for new files","ok"]],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"AwsLambda","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"python2.7","lambdaMemorySize":128,"lambdaTimeout":60,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"boto3;requests","lambdaZipfile":"","scriptName":"CreateEC2Instance.py"}],"exportWarnings":[]},{"target":32,"name":"API Login","requiredTags":{},"fromRoutes":[["Launch analyzer host",""]],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"AwsLambda","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"python2.7","lambdaMemorySize":128,"lambdaTimeout":15,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"requests","lambdaZipfile":"","scriptName":"SGApiLogin"}],"exportWarnings":[]},{"target":32,"name":"Create analyze jobs","requiredTags":{},"fromRoutes":[["API Login",""]],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"AwsLambda","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"nodejs10.x","lambdaMemorySize":128,"lambdaTimeout":30,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"axios","lambdaZipfile":"","scriptName":"CreateAnalyzeJobs.js"}],"exportWarnings":[]}]},{"version":"0.0","name":"Stop Agent and Terminate EC2","maxInstances":1,"misFireGraceTime":null,"coalesce":true,"pauseOnJobFail":false,"runtimeVars":{},"schedules":[],"taskDefs":[{"target":32,"name":"API Login","requiredTags":{},"fromRoutes":[],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"AwsLambda","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"python2.7","lambdaMemorySize":128,"lambdaTimeout":15,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"requests","lambdaZipfile":"","scriptName":"SGApiLogin"}],"exportWarnings":[]},{"target":16,"name":"Get ec2 inst id and region","requiredTags":{},"fromRoutes":[["API Login",""]],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"run","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"","lambdaMemorySize":128,"lambdaTimeout":3,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"","lambdaZipfile":"","scriptName":"GetEC2InstanceIdAndRegion.sh"}],"exportWarnings":[]},{"target":32,"name":"Terminate agent","requiredTags":{},"fromRoutes":[["Get ec2 inst id and region",""]],"toRoutes":[],"autoRestart":false,"stepDefs":[{"name":"AwsLambda","order":1,"command":"","arguments":"","variables":{},"lambdaCodeSource":"script","lambdaRuntime":"nodejs10.x","lambdaMemorySize":128,"lambdaTimeout":60,"lambdaFunctionHandler":"","lambdaAWSRegion":"","lambdaDependencies":"axios","lambdaZipfile":"","scriptName":"StopAgentAndTerminateEC2Host.js"}],"exportWarnings":[]}]}],"scripts":[{"name":"DownloadS3File.sh","scriptType":2,"code":"aWYgWyAiQHNnZygibG9jYWxGaWxlUGF0aCIpIiAhPSAibnVsbCIgXQp0aGVuCiAgICBMT0NBTF9GSUxFX1BBVEg9IkBzZ2coImxvY2FsRmlsZVBhdGgiKSIKZWxzZQogICAgTE9DQUxfRklMRV9QQVRIPSIuIgpmaQoKYXdzIHMzIGNwIEBzZ2coInMzRmlsZVBhdGgiKSAke0xPQ0FMX0ZJTEVfUEFUSH0KCiMgYXdzIHMzIG12IEBzZ2coInMzRmlsZVBhdGgiKSBAc2dnKCJzM0lucHJvY0ZpbGVQYXRoIik=","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"RunWordCount.sh","scriptType":2,"code":"ZmlsZW5hbWU9IiQoYmFzZW5hbWUgQHNnZygiczNGaWxlUGF0aCIpKSIKamF2YSAtamFyIHdvcmQtY291bnQtMC4xLjAtU05BUFNIT1Qtc3RhbmRhbG9uZS5qYXIgJGZpbGVuYW1l","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"S3FileWatcher.js","scriptType":1,"code":"Ly8gTG9hZCB0aGUgU0RLIGZvciBKYXZhU2NyaXB0CnZhciBBV1MgPSByZXF1aXJlKCdhd3Mtc2RrJyk7Ci8vIFNldCB0aGUgUmVnaW9uIApBV1MuY29uZmlnLnVwZGF0ZSh7cmVnaW9uOiAndXMtZWFzdC0yJywgYWNjZXNzS2V5SWQ6J0BzZ2coIkFXU19BQ0NFU1NfS0VZX0lEIiknLCBzZWNyZXRBY2Nlc3NLZXk6J0BzZ2coIkFXU19TRUNSRVRfQUNDRVNTX0tFWSIpJ30pOwoKLy8gQ3JlYXRlIFMzIHNlcnZpY2Ugb2JqZWN0CnMzID0gbmV3IEFXUy5TMyh7YXBpVmVyc2lvbjogJzIwMDYtMDMtMDEnfSk7CgoKbGV0IGxpc3RGaWxlcyA9IGFzeW5jIChidWNrZXQsIHByZWZpeCwgbGlzdCA9IFtdKSA9PiB7CiAgY29uc3QgcGFyYW1zID0gewogICAgICBCdWNrZXQ6IGJ1Y2tldCwKICAgICAgUHJlZml4OiBwcmVmaXgsCiAgICAgIE1heEtleXM6IDUwCiAgfTsKCiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgczMubGlzdE9iamVjdHNWMihwYXJhbXMsIGFzeW5jIChlcnIsIGRhdGEpID0+IHsKICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDQpKTsKICAgICAgICAgICAgICBpZiAoZGF0YS5Db250ZW50cyAmJiBkYXRhLkNvbnRlbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLkNvbnRlbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdC5wdXNoKGBzMzovLyR7YnVja2V0fS8ke2RhdGEuQ29udGVudHNbaV0uS2V5fWApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChkYXRhLklzVHJ1bmNhdGVkKSB7CiAgICAgICAgICAgICAgICAgIGxpc3QgPSBhd2FpdCBsaXN0RmlsZXMocHJlZml4LCBidWNrZXQsIGxpc3QsIGRhdGEuTmV4dENvbnRpbnVhdGlvblRva2VuKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTsKICAgICAgICAgIH0KICAgICAgfSk7CiAgfSk7Cn07CgooYXN5bmMgKCkgPT4gewogICAgbGV0IGxpc3QgPSBhd2FpdCBsaXN0RmlsZXMoJ0BzZ2coInMzQnVja2V0IiknLCAnQHNnZygiczNQcmVmaXgiKS8nKTsKICAgIGlmIChsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zb2xlLmxvZyhgQHNnb3siZmlsZXMiOiAiJHtsaXN0LmpvaW4oKX0ifWApOwogICAgICAgIGNvbnNvbGUubG9nKCdAc2dveyJyb3V0ZSI6ICJvayJ9Jyk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCdAc2dveyJyb3V0ZSI6ICJub3RoaW5nX3RvX2RvIn0nKTsKICAgIH0KfSkoKTs=","teamUsable":true,"teamEditable":true,"isActive":true},{"name":"CreateEC2Instance.py","scriptType":0,"code":"aW1wb3J0IGJhc2U2NAppbXBvcnQgc3lzCmltcG9ydCBvcwpmcm9tIG9zIGltcG9ydCBwYXRoCmltcG9ydCByZXF1ZXN0cwppbXBvcnQganNvbgpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQppbXBvcnQgdGltZQppbXBvcnQgbWF0aAoKQHNncygiZWMyX2FjY2Vzcy5weSIpCgoKZGVmIENyZWF0ZUVDMkluc3RhbmNlcyh0YWdzLCBjb3VudCk6CiAgICBkYXRhID0gIiIiIyEvdXNyL2Jpbi9weXRob24KaW1wb3J0IHN5cwppbXBvcnQgb3MKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCBnemlwCmltcG9ydCBzaHV0aWwKaW1wb3J0IHRpbWUKCgp0b2tlbiA9ICcnCgoKdGVhbUlkID0gW3RlYW1JZF0KYWNjZXNzS2V5SWQgPSBbYWNjZXNzS2V5SWRdCmFjY2Vzc0tleVNlY3JldCA9IFthY2Nlc3NLZXlTZWNyZXRdCndvcmtpbmdkaXIgPSBbd29ya2luZ2Rpcl0KcGxhdGZvcm0gPSBbcGxhdGZvcm1dCmFyY2ggPSBbYXJjaF0KY29uZmlnID0gW2NvbmZpZ10KbG9naW51cmwgPSBbbG9naW51cmxdCmFwaXVybCA9IFthcGl1cmxdCgp0cnk6CiAgICBvcy5ta2Rpcih3b3JraW5nZGlyKQpleGNlcHQgKE9TRXJyb3IpIGFzIGVycjoKICAgIHBhc3MKCm91dEZpbGUgPSAne30vc2ctYWdlbnQtbGF1bmNoZXInLmZvcm1hdCh3b3JraW5nZGlyKQoKCmRlZiBSZXN0QVBJTG9naW4oKToKICAgIGdsb2JhbCB0b2tlbgogICAgZ2xvYmFsIHRlYW1JZAogICAgZ2xvYmFsIGFjY2Vzc0tleUlkCiAgICBnbG9iYWwgYWNjZXNzS2V5U2VjcmV0CgogICAgdXJsID0gJ2h0dHBzOi8vY29uc29sZS5zYWFzZ2x1ZS5jb20vbG9naW4vYXBpbG9naW4nCiAgICAKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgfQoKICAgIGRhdGEgPSB7CiAgICAgICAgJ2FjY2Vzc0tleUlkJzogYWNjZXNzS2V5SWQsCiAgICAgICAgJ2FjY2Vzc0tleVNlY3JldCc6IGFjY2Vzc0tleVNlY3JldAogICAgfQoKICAgIHJlcyA9IHJlcXVlc3RzLnBvc3QodXJsPXVybCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWpzb24uZHVtcHMoZGF0YSkpCiAgICBpZiAocmVzLnN0YXR1c19jb2RlICE9IDIwMCk6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKAogICAgICAgICAgICAnQ2FsbCB0byB7fSByZXR1cm5lZCB7fSAtIHt9Jy5mb3JtYXQodXJsLCByZXMuc3RhdHVzX2NvZGUsIHJlcy50ZXh0KSkKCiAgICB0b2tlbiA9IGpzb24ubG9hZHMocmVzLnRleHQpWydjb25maWcxJ10KICAgIHRlYW1JZCA9IGpzb24ubG9hZHMocmVzLnRleHQpWydjb25maWczJ10KCgpkZWYgR2V0RG93bmxvYWRVcmwoKToKICAgIGdsb2JhbCB0b2tlbgogICAgZ2xvYmFsIHRlYW1JZAogICAgZ2xvYmFsIHBsYXRmb3JtCiAgICBnbG9iYWwgYXJjaAoKICAgIHdoaWxlIHRva2VuID09ICcnOgogICAgICAgIFJlc3RBUElMb2dpbigpCiAgICAgICAgaWYgdG9rZW4gPT0gJyc6CiAgICAgICAgICAgIHByaW50KCdBUEkgbG9naW4gZmFpbGVkJykKICAgICAgICAgICAgdGltZS5zbGVlcCg1KQogICAgICAgICAgICBwcmludCgnUmV0cnlpbmcgYXBpIGxvZ2luJykKICAgIAogICAgdXJsID0gJ2h0dHBzOi8vY29uc29sZS5zYWFzZ2x1ZS5jb20vYXBpL3YwL2FnZW50RG93bmxvYWQvYWdlbnRzdHViL3t9Jy5mb3JtYXQocGxhdGZvcm0pCiAgICBpZiBhcmNoOgogICAgICAgIHVybCArPSAoJy8nICsgYXJjaCkKCiAgICBoZWFkZXJzID0gewogICAgCSdDb29raWUnOiAnQXV0aD17fTsnLmZvcm1hdCh0b2tlbiksCiAgICAgICAgJ190ZWFtSWQnOiB0ZWFtSWQKICAgIH0KCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHJlcyA9IHJlcXVlc3RzLmdldCh1cmw9dXJsLCBoZWFkZXJzPWhlYWRlcnMpCgogICAgICAgIHByaW50KCdyZXMxID0gJywgcmVzLmpzb24oKSkKICAgICAgICBwcmludCgncmVzMiA9ICcsIHJlcy5qc29uKClbJ2RhdGEnXSkKICAgICAgICBpZiAocmVzLnN0YXR1c19jb2RlID09IDIwMCk6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXNfY29kZSA9PSAzMDMpOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxMCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAnQ2FsbCB0byB7fSByZXR1cm5lZCB7fSAtIHt9Jy5mb3JtYXQodXJsLCByZXMuc3RhdHVzX2NvZGUsIHJlcy50ZXh0KSkKCiAgICByZXR1cm4gcmVzLmpzb24oKVsnZGF0YSddCgoKZGVmIERvd25sb2FkQWdlbnQoKToKICAgIGdsb2JhbCBwbGF0Zm9ybQoKICAgIHMzdXJsID0gR2V0RG93bmxvYWRVcmwoKQoKICAgIHJlcyA9IHJlcXVlc3RzLmdldChzM3VybCwgYWxsb3dfcmVkaXJlY3RzPVRydWUpCgogICAgb3Blbignc2ctYWdlbnQtbGF1bmNoZXIuZ3onLCAnd2InKS53cml0ZShyZXMuY29udGVudCkKCiAgICB3aXRoIGd6aXAub3Blbignc2ctYWdlbnQtbGF1bmNoZXIuZ3onLCAncmInKSBhcyBmX2luOgogICAgICAgIHdpdGggb3BlbihvdXRGaWxlLCAnd2InKSBhcyBmX291dDoKICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlb2JqKGZfaW4sIGZfb3V0KQogICAgICAgIG9zLmNobW9kKG91dEZpbGUsIDBvNzc3KQoKICAgIG9zLnJlbW92ZSgnc2ctYWdlbnQtbGF1bmNoZXIuZ3onKQoKCgpEb3dubG9hZEFnZW50KCkKCmNvbmZpZ0ZpbGUgPSAne30vc2cuY2ZnJy5mb3JtYXQod29ya2luZ2RpcikKd2l0aCBvcGVuKGNvbmZpZ0ZpbGUsICd3JykgYXMgZjoKICAgIGpzb24uZHVtcChjb25maWcsIGYsIGluZGVudD00KQpvcy5zeXN0ZW0oJ2Nob3duIGVjMi11c2VyOmVjMi11c2VyIHt9Jy5mb3JtYXQoY29uZmlnRmlsZSkpCgpvcy5jaGRpcih3b3JraW5nZGlyKQpvcy5zeXN0ZW0oJ3N1IC0gZWMyLXVzZXIgLWMge30nLmZvcm1hdChvdXRGaWxlKSkKIiIiCgogICAgZGF0YSA9IGRhdGEucmVwbGFjZSgnW3RlYW1JZF0nLCAnIkBzZ2coInNnVGVhbUlkIikiJykKICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoJ1thY2Nlc3NLZXlJZF0nLCAnIkBzZ2coImFnZW50RG93bmxvYWRBY2Nlc3NLZXlJZCIpIicpCiAgICBkYXRhID0gZGF0YS5yZXBsYWNlKCdbYWNjZXNzS2V5U2VjcmV0XScsICciQHNnZygiYWdlbnREb3dubG9hZEFjY2Vzc0tleVNlY3JldCIpIicpCiAgICBkYXRhID0gZGF0YS5yZXBsYWNlKCdbd29ya2luZ2Rpcl0nLCAnIkBzZ2coIndvcmtpbmdkaXIiKSInKQogICAgZGF0YSA9IGRhdGEucmVwbGFjZSgnW3BsYXRmb3JtXScsICcibGludXgiJykKICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoJ1thcmNoXScsICdOb25lJykKICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoJ1tsb2dpbnVybF0nLCAnIkBzZ2coInNnTG9naW5VcmwiKSInKQogICAgZGF0YSA9IGRhdGEucmVwbGFjZSgnW2FwaXVybF0nLCAnIkBzZ2coInNnQXBpVXJsIikiJykKICAgIAogICAgY29uZmlnID0geyd0YWdzJzogQHNnZygidGFncyIpLCAnU0dfQUNDRVNTX0tFWV9JRCc6ICdAc2dnKCJhZ2VudEFjY2Vzc0tleUlkIiknLCAnU0dfQUNDRVNTX0tFWV9TRUNSRVQnOiAnQHNnZygiYWdlbnRBY2Nlc3NLZXlTZWNyZXQiKScsICdwcm9wZXJ0eU92ZXJyaWRlcyc6IHsnbWF4QWN0aXZlVGFza3MnOiAgQHNnZygibWF4QWdlbnRUYXNrcyIpLCAnaW5hY3RpdmVQZXJpb2RXYWl0VGltZSc6IEBzZ2coImluYWN0aXZlUGVyaW9kV2FpdFRpbWUiKX19CiAgICBpZiAnQHNnZygiSW5hY3RpdmVBZ2VudEpvYklkIiknICE9ICdudWxsJzoKICAgICAgICBjb25maWdbJ3Byb3BlcnR5T3ZlcnJpZGVzJ11bJ2luYWN0aXZlQWdlbnRKb2InXSA9IHsnaWQnOiAnQHNnZygiSW5hY3RpdmVBZ2VudEpvYklkIiknLCAncnVudGltZVZhcnMnOiB7J3NnQVBJQWNjZXNzS2V5SWQnOiAnQHNnZygic3RvcEFnZW50QVBJQWNjZXNzS2V5SWQiKScsICdzZ0FQSUFjY2Vzc0tleVNlY3JldCc6ICdAc2dnKCJzdG9wQWdlbnRBUElBY2Nlc3NLZXlTZWNyZXQiKSd9fQogICAgZGF0YSA9IGRhdGEucmVwbGFjZSgnW2NvbmZpZ10nLCBqc29uLmR1bXBzKGNvbmZpZykpCgoKCiAgICAjIHByaW50ICdcbicgKyBkYXRhICsgJ1xuJwoKICAgIGRhdGFfYnl0ZXMgPSBkYXRhLmVuY29kZSgndXRmOCcpCiAgICBiYXNlNjRfYnl0ZXMgPSBiYXNlNjQuYjY0ZW5jb2RlKGRhdGFfYnl0ZXMpCgogICAgaWFtUm9sZSA9IE5vbmUKICAgIGlmICdAc2dnKElBTVJvbGUpJyAhPSAnTm9uZSc6CiAgICAgICAgaWFtUm9sZSA9ICdAc2dnKElBTVJvbGUpJwogICAgdGFnc1snTmFtZSddID0gJ0BzZ2coImluc3RhbmNlTmFtZVRhZyIpJwogICAgcmVzID0gbGF1bmNoX2VjMl9pbnN0YW5jZSgnQHNnZyhJbWFnZUlkKScsICdAc2dnKEtleU5hbWUpJywgJ0BzZ2coSW5zdGFuY2VUeXBlKScsIEBzZ2coU2VjdXJpdHlHcm91cElkcyksICdAc2dnKFN1Ym5ldElkKScsICdAc2dnKFZwY0lkKScsIGNvdW50LCBjb3VudCwgYmFzZTY0X2J5dGVzLCBpYW1Sb2xlLCB0YWdzKQogICAgaWYgcmVzWzBdOgogICAgICAgIHByaW50KCdAc2dveyJlYzJfaW5zdGFuY2VfaWQiOiAiJyArICcsJy5qb2luKHJlc1sxXSkgKyAnIn0nKQogICAgZWxzZToKICAgICAgICBwcmludCgnRmFpbGVkIHRvIGNyZWF0ZSBlYzIgaW5zdGFuY2UnKQogICAgICAgIAoKdGFncyA9IGpzb24ubG9hZHMoJ0BzZ2coInRhZ3MiKScpCnRhZ3NBcnJheSA9IFtdCmZvciB0IGluIHRhZ3M6CiAgICB0YWdzQXJyYXkuYXBwZW5kKHsna2V5JzogdCwgJ3ZhbHVlJzogdGFnc1t0XX0pCgpDcmVhdGVFQzJJbnN0YW5jZXModGFncywgQHNnZyhOdW1JbnN0YW5jZXMpKQo=","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"SGApiLogin","scriptType":0,"code":"aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCgoKdG9rZW4gPSAnJwoKZGVmIFJlc3RBUElMb2dpbigpOgogICAgZ2xvYmFsIHRva2VuCgogICAgdXJsID0gJ0BzZ2coInNnTG9naW5VcmwiKScKICAgIAogICAgaGVhZGVycyA9IHsKICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICB9CgogICAgZGF0YSA9IHsKICAgICAgICAnYWNjZXNzS2V5SWQnOiAnQHNnZygic2dBUElBY2Nlc3NLZXlJZCIpJywKICAgICAgICAnYWNjZXNzS2V5U2VjcmV0JzogJ0BzZ2coInNnQVBJQWNjZXNzS2V5U2VjcmV0IiknCiAgICB9CgogICAgIyBwcmludCAnZGF0YSAtPiAnLCBkYXRhCgogICAgcmVzID0gcmVxdWVzdHMucG9zdCh1cmw9dXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhkYXRhKSkKICAgIGlmICdzdGF0dXNfY29kZScgaW4gcmVzIGFuZCByZXNbJ3N0YXR1c19jb2RlJ10gIT0gMjAwOgogICAgICAgIG1zZyA9ICdDYWxsIHRvIHt9IHJldHVybmVkIHt9IC0ge30nLmZvcm1hdCh1cmwsIHJlcy5zdGF0dXNfY29kZSwgcmVzLnRleHQpCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKG1zZykKCiAgICBwcmludCgncmVzIC0+ICcsIHJlcy50ZXh0KQogICAgICAgIAogICAgdG9rZW4gPSBqc29uLmxvYWRzKHJlcy50ZXh0KVsnY29uZmlnMSddCgoKd2hpbGUgdG9rZW4gPT0gJyc6CiAgICBSZXN0QVBJTG9naW4oKQogICAgaWYgdG9rZW4gPT0gJyc6CiAgICAgICAgcHJpbnQgJ0FQSSBsb2dpbiBmYWlsZWQnCiAgICAgICAgc3lzLnN0ZG91dC5mbHVzaAogICAgICAgIHRpbWUuc2xlZXAoNSkKICAgICAgICBwcmludCAnUmV0cnlpbmcgYXBpIGxvZ2luJwogICAgICAgIHN5cy5zdGRvdXQuZmx1c2gKCnByaW50ICdAc2dve3sic2dBdXRoVG9rZW4iOiAie30ifX0nLmZvcm1hdCh0b2tlbik=","teamUsable":true,"teamEditable":true,"isActive":true},{"name":"CreateAnalyzeJobs.js","scriptType":1,"code":"Y29uc3QgYXhpb3NfMSA9IHJlcXVpcmUoImF4aW9zIik7CgoKQHNncygiUmVzdEFQSUNhbGwuanMiKTsKCgpsZXQgUnVuQW5hbHl6ZUpvYiA9IGFzeW5jIChmaWxlUGF0aCkgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCBhdXRoID0gJ0BzZ2coInNnQXV0aFRva2VuIiknOwoKICAgICAgICBjb25zdCBqb2JEZWZJZCA9ICJAc2dnKCJqb2JEZWZJZCIpIjsKCiAgICAgICAgY29uc29sZS5sb2coYFJ1bm5pbmcgam9iIHRvIGFuYWx5emUgZmlsZSAiJHtmaWxlUGF0aH0iYCk7CgogICAgICAgIGF3YWl0IFJlc3RBUElDYWxsKGBqb2JgLCAnUE9TVCcsICdAc2dnKCJzZ1RlYW1JZCIpJywgCiAgICAgICAgewogICAgICAgICAgICBfam9iRGVmSWQ6IGpvYkRlZklkCiAgICAgICAgfSwgCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6IGBBbmFseXplIGZpbGUgLSAke2ZpbGVQYXRofWAsCiAgICAgICAgICAgICJydW50aW1lVmFycyI6IHsKICAgICAgICAgICAgICAgICJzM0ZpbGVQYXRoIjogZmlsZVBhdGgKICAgICAgICAgICAgfQogICAgICAgIH0sIGF1dGgpOwoKICAgICAgICBwcm9jZXNzLmV4aXQoMCk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgcnVubmluZyBqb2I6ICcsIGVyci5tZXNzYWdlKTsKICAgICAgICBwcm9jZXNzLmV4aXQoLTEpOwogICAgfQp9OwoKCmxldCBmaWxlcyA9ICdAc2dnKCJmaWxlcyIpJy5zcGxpdCgnLCcpOwpmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKQogICAgUnVuQW5hbHl6ZUpvYihmaWxlc1tpXSk7","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"GetEC2InstanceIdAndRegion.sh","scriptType":2,"code":"QVdTX0lOU1RBTkNFX0lEPWBjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZGAKUkVHSU9OPSQoY3VybCAtcyBodHRwOi8vMTY5LjI1NC4xNjkuMjU0L2xhdGVzdC9keW5hbWljL2luc3RhbmNlLWlkZW50aXR5L2RvY3VtZW50IHwgYXdrIC1GJyInICcvXCJyZWdpb25cIi8geyBwcmludCAkNCB9JykKCnByaW50ZiAnQHNnb3siYXdzSW5zdGFuY2VJZCI6IiVzIn1cbicgIiRBV1NfSU5TVEFOQ0VfSUQiCnByaW50ZiAnQHNnb3siYXdzUmVnaW9uIjoiJXMifScgIiRSRUdJT04i","teamUsable":true,"teamEditable":true,"isActive":true},{"name":"StopAgentAndTerminateEC2Host.js","scriptType":1,"code":"Y29uc3QgYXhpb3NfMSA9IHJlcXVpcmUoImF4aW9zIik7CmNvbnN0IGNoaWxkX3Byb2Nlc3NfMSA9IHJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKTsKCgpAc2dzKCJSZXN0QVBJQ2FsbC5qcyIpOwoKQHNncygiUnVuQ29tbWFuZC5qcyIpOwoKQHNncygiU2xlZXAuanMiKTsKCkBzZ3MoIlN0b3BFQzJJbnN0YW5jZXMuanMiKTsKCmxldCBTdG9wQWdlbnRBbmRUZXJtaW5hdGVFQzJIb3N0ID0gYXN5bmMgKCkgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCBhdXRoID0gJ0BzZ2coInNnQXV0aFRva2VuIiknOwoKICAgICAgICBjb25zdCBfdGVhbUlkID0gJ0BzZ2coInNnVGVhbUlkIiknOwogICAgICAgIGlmIChfdGVhbUlkID09ICJudWxsIikgewogICAgICAgICAgICBjb25zb2xlLmxvZygnTWlzc2luZyBzZ1RlYW1JZCBwYXJhbWV0ZXIgLSBleGl0aW5nJyk7CiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7CiAgICAgICAgfQoKICAgICAgICBsZXQgX2FnZW50SWQgPSAiQHNnZygiX2FnZW50SWQiKSI7CiAgICAgICAgaWYgKF9hZ2VudElkID09ICJudWxsIikgewogICAgICAgICAgICBjb25zb2xlLmxvZygnTWlzc2luZyBfYWdlbnRJZCBwYXJhbWV0ZXIgLSBleGl0aW5nJyk7CiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7CiAgICAgICAgfQoKICAgICAgICBsZXQgYXdzSW5zdGFuY2VJZCA9ICJAc2dnKCJhd3NJbnN0YW5jZUlkIikiOwogICAgICAgIGlmIChhd3NJbnN0YW5jZUlkID09ICJudWxsIikgewogICAgICAgICAgICBjb25zb2xlLmxvZygnTWlzc2luZyBhd3NJbnN0YW5jZUlkIHBhcmFtZXRlciAtIGV4aXRpbmcnKTsKICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTsKICAgICAgICB9CgogICAgICAgIGxldCBzdG9wQWdlbnRSZXMgPSBhd2FpdCBSZXN0QVBJQ2FsbChgYWdlbnQvc3RvcC8ke19hZ2VudElkfWAsICdQVVQnLCAnQHNnZygic2dUZWFtSWQiKScsIG51bGwsIG51bGwsIGF1dGgpOwogICAgICAgIGlmIChzdG9wQWdlbnRSZXMuZGF0YS5zdGF0dXNDb2RlICE9IDIwMCkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3Igc3RvcHBpbmcgYWdlbnQgLSBhcGkgY2FsbCByZXR1cm5lZFxuXG4ke0pTT04uc3RyaW5naWZ5KHN0b3BBZ2VudFJlcy5kYXRhLCBudWxsLCA0KX1gKTsKICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IG1heFRyaWVzID0gMzY7CiAgICAgICAgbGV0IHRyeUNvdW50ID0gMDsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBsZXQgZ2V0QWdlbnRSZXMgPSBhd2FpdCBSZXN0QVBJQ2FsbChgYWdlbnQvJHtfYWdlbnRJZH0/cmVzcG9uc2VGaWVsZHM9b2ZmbGluZWAsICdHRVQnLCAnQHNnZygic2dUZWFtSWQiKScsIG51bGwsIG51bGwsIGF1dGgpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhgZ2V0QWdlbnRSZXMgLT4gJHtKU09OLnN0cmluZ2lmeShnZXRBZ2VudFJlcy5kYXRhKX1gKTsKICAgICAgICAgICAgaWYgKGdldEFnZW50UmVzLmRhdGEuc3RhdHVzQ29kZSA9PSAyMDAgJiYgZ2V0QWdlbnRSZXMuZGF0YS5kYXRhLm9mZmxpbmUpewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeUNvdW50ICs9IDE7CiAgICAgICAgICAgIGlmICh0cnlDb3VudCA+IG1heFRyaWVzKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVGltZW91dCBzdG9wcGluZyBhZ2VudGApOwogICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgc2xlZXAoNTAwMCk7CiAgICAgICAgfQoKICAgICAgICBsZXQgY21kUmVzID0gYXdhaXQgU3RvcEVDMkluc3RhbmNlcyhbYXdzSW5zdGFuY2VJZF0pOwoKICAgICAgICAvLyBjb25zb2xlLmxvZyhgVGVybWluYXRlIEVDMiBpbnN0YW5jZSBjb21tYW5kOiAke2NtZH1gKTsKICAgICAgICBjb25zb2xlLmxvZyhgVGVybWluYXRlIEVDMiBpbnN0YW5jZSBjb21tYW5kIHJlc3VsdDogJHtKU09OLnN0cmluZ2lmeShjbWRSZXMsIG51bGwsIDQpfWApOwoKICAgICAgICBwcm9jZXNzLmV4aXQoMCk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgZGVsZXRpbmcgam9iczogJywgZXJyLm1lc3NhZ2UpOwogICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7CiAgICB9Cn07CgoKU3RvcEFnZW50QW5kVGVybWluYXRlRUMySG9zdCgpOw==","teamUsable":true,"teamEditable":true,"isActive":true},{"name":"StopEC2Instances.js","scriptType":1,"code":"Ly8gTG9hZCB0aGUgQVdTIFNESyBmb3IgTm9kZS5qcwp2YXIgQVdTID0gcmVxdWlyZSgnYXdzLXNkaycpOwoKbGV0IGF3c1JlZ2lvbiA9ICJAc2dnKCJhd3NSZWdpb24iKSI7CmlmIChhd3NSZWdpb24gPT0gIm51bGwiKSB7CiAgICBjb25zb2xlLmxvZygnTWlzc2luZyBhd3NSZWdpb24gcGFyYW1ldGVyIC0gZXhpdGluZycpOwogICAgcHJvY2Vzcy5leGl0KC0xKTsKfQoKLy8gU2V0IHRoZSByZWdpb24gCkFXUy5jb25maWcudXBkYXRlKHtyZWdpb246IGF3c1JlZ2lvbn0pOwoKLy8gQ3JlYXRlIEVDMiBzZXJ2aWNlIG9iamVjdAp2YXIgZWMyID0gbmV3IEFXUy5FQzIoe2FwaVZlcnNpb246ICcyMDE2LTExLTE1JywgYWNjZXNzS2V5SWQ6ICdAc2dnKCJBV1NfQUNDRVNTX0tFWV9JRCIpJywgc2VjcmV0QWNjZXNzS2V5OiAnQHNnZygiQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZIiknfSk7CgpsZXQgU3RvcEVDMkluc3RhbmNlcyA9IGFzeW5jIChpbnN0YW5jZUlkcykgPT4gewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICB2YXIgcGFyYW1zID0gewogICAgICAgICAgICBJbnN0YW5jZUlkczogaW5zdGFuY2VJZHMKICAgICAgICB9OwoKICAgICAgICAvLyBDYWxsIEVDMiB0byBzdG9wIHRoZSBzZWxlY3RlZCBpbnN0YW5jZXMKICAgICAgICBlYzIuc3RvcEluc3RhbmNlcyhwYXJhbXMsIGZ1bmN0aW9uKGVyciwgZGF0YSkgewogICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3Igc3RvcHBpbmcgaW5zdGFuY2VzOiAiLCBlcnIpOwogICAgICAgICAgICAgICAgcmVqZWN0KGVycik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKfQ==","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"Sleep.js","scriptType":1,"code":"bGV0IHNsZWVwID0gYXN5bmMgKG1zKSA9PiB7CiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgc2V0VGltZW91dChyZXNvbHZlLCBtcyk7CiAgICB9KQp9Cg==","teamUsable":true,"teamEditable":true,"isActive":true},{"name":"RunCommand.js","scriptType":1,"code":"bGV0IFJ1bkNvbW1hbmQgPSBhc3luYyAoY29tbWFuZFN0cmluZywgb3B0aW9ucykgPT4gewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgICBsZXQgc3Rkb3V0ID0gJyc7CiAgICAgICAgICAgIGxldCBzdGRlcnIgPSAnJzsKICAgICAgICAgICAgbGV0IGNtZCA9IGNoaWxkX3Byb2Nlc3NfMS5leGVjKGNvbW1hbmRTdHJpbmcsIG9wdGlvbnMpOwogICAgICAgICAgICBjbWQuc3Rkb3V0Lm9uKCdkYXRhJywgKGRhdGEpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHN0ciA9IGRhdGEudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICBzdGRvdXQgKz0gc3RyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY21kLnN0ZGVyci5vbignZGF0YScsIChkYXRhKSA9PiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHN0ZGVyciArPSBkYXRhLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjbWQub24oJ2V4aXQnLCAoY29kZSkgPT4gewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsgJ2NvZGUnOiBjb2RlLCAnc3Rkb3V0Jzogc3Rkb3V0LCAnc3RkZXJyJzogc3RkZXJyIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICB9KTsKfQ==","teamUsable":true,"teamEditable":true,"isActive":true},{"name":"RestAPICall.js","scriptType":1,"code":"bGV0IFJlc3RBUElDYWxsID0gYXN5bmMgKHVybCwgbWV0aG9kLCBfdGVhbUlkLCBoZWFkZXJzID0ge30sIGRhdGEgPSB7fSwgdG9rZW4gPSB1bmRlZmluZWQpID0+IHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGV0IGFwaVVybCA9ICdAc2dnKCJzZ0FwaVVybCIpJzsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2FnZW50TG9nc0FQSVZlcnNpb24gLT4gQHNnZygiYWdlbnRMb2dzQVBJVmVyc2lvbiIpJyk7CiAgICAgICAgICAgIGNvbnN0IGFwaVZlcnNpb24gPSAnQHNnZygiYWdlbnRMb2dzQVBJVmVyc2lvbiIpJzsKICAgICAgICAgICAgbGV0IGFwaVBvcnQgPSAnJzsKICAgICAgICAgICAgaWYgKCdudWxsJyAhPSAnQHNnZygic2dBcGlQb3J0IiknKQogICAgICAgICAgICAgICAgYXBpUG9ydCA9IEBzZ2coInNnQXBpUG9ydCIpOwogICAgICAgICAgICBpZiAoYXBpUG9ydCAhPSAnJykKICAgICAgICAgICAgICAgIGFwaVVybCArPSBgOiR7YXBpUG9ydH1gOwogICAgICAgICAgICB1cmwgPSBgJHthcGlVcmx9L2FwaS8ke2FwaVZlcnNpb259LyR7dXJsfWA7CiAgICAgICAgICAgIGNvbnN0IGNvbWJpbmVkSGVhZGVycyA9IE9iamVjdC5hc3NpZ24oewogICAgICAgICAgICAgICAgQ29va2llOiBgQXV0aD1Ac2dnKCJzZ0F1dGhUb2tlbiIpYCwKICAgICAgICAgICAgICAgIF90ZWFtSWQ6IF90ZWFtSWQKICAgICAgICAgICAgfSwgaGVhZGVycyk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdSZXN0QVBJQ2FsbCAtPiB1cmwgJywgdXJsLCAnLCBtZXRob2QgLT4gJywgbWV0aG9kLCAnLCBoZWFkZXJzIC0+ICcsIGNvbWJpbmVkSGVhZGVycywgJywgZGF0YSAtPiAnLCBkYXRhKTsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvc18xLmRlZmF1bHQoewogICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICByZXNwb25zZVR5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IGNvbWJpbmVkSGVhZGVycywKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBlLm1lc3NhZ2UgPSBgUmVzdEFQSUNhbGwgZXJyb3Igb2NjdXJyZWQgY2FsbGluZyAke21ldGhvZH0gb24gJyR7dXJsfSc6ICR7ZS5tZXNzYWdlfWA7CiAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICB9KTsKfQo=","teamUsable":true,"teamEditable":false,"isActive":true},{"name":"ec2_access.py","scriptType":0,"code":"aW1wb3J0IHN5cwppbXBvcnQgYm90bzMKZnJvbSBib3RvY29yZS5leGNlcHRpb25zIGltcG9ydCBDbGllbnRFcnJvcgpmcm9tIGJvdG9jb3JlLmV4Y2VwdGlvbnMgaW1wb3J0IFdhaXRlckVycm9yCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgdGltZQoKc2Vzc2lvbiA9IGJvdG8zLlNlc3Npb24oYXdzX2FjY2Vzc19rZXlfaWQ9J0BzZ2coIkFXU19BQ0NFU1NfS0VZX0lEIiknLCBhd3Nfc2VjcmV0X2FjY2Vzc19rZXk9J0BzZ2coIkFXU19TRUNSRVRfQUNDRVNTX0tFWSIpJykKZWMyID0gc2Vzc2lvbi5yZXNvdXJjZSgnZWMyJykKZWMyX2NsaWVudCA9IGJvdG8zLmNsaWVudCgnZWMyJywgcmVnaW9uX25hbWU9J0BzZ2coIkFXU19SRUdJT04iKScsIGF3c19hY2Nlc3Nfa2V5X2lkPSdAc2dnKCJBV1NfQUNDRVNTX0tFWV9JRCIpJywgYXdzX3NlY3JldF9hY2Nlc3Nfa2V5PSdAc2dnKCJBV1NfU0VDUkVUX0FDQ0VTU19LRVkiKScpCgojIGxhdW5jaF9lYzJfaW5zdGFuY2UoJ2FtaS0wOTllODgyYjA4NzZjODEyNCcsICdraWtpLTIwMTlRMScsICd0MS5taWNybycsIFsnc2ctMDM2ZGUyNTM3YzA1OWE0YWYnXSwgJ3N1Ym5ldC1kNDdhMmJmYScsICd2cGMtZDJkM2I0YTgnKQoKZGVmIGxhdW5jaF9lYzJfaW5zdGFuY2UoYW1pX2lkLCBrZXlfcGFpcl9uYW1lLCBpbnN0YW5jZV90eXBlLCBzZWN1cml0eV9ncm91cF9pZHMsIHN1Ym5ldF9pZCwgdnBjPU5vbmUsIG1pbmNvdW50PTEsIG1heGNvdW50PTEsIHVzZXJfZGF0YT0nJywgaWFtX3JvbGU9Tm9uZSwgdGFncz1Ob25lKToKICAgIHByaW50KCdMYXVuY2hpbmcgYmV0d2VlbiB7fSBhbmQge30gZWMyIGluc3RhbmNlcyBvZiB0eXBlICJ7fSInLmZvcm1hdChtaW5jb3VudCwgbWF4Y291bnQsIGluc3RhbmNlX3R5cGUpKQoKICAgIHRhZ1NwZWNpZmljYXRpb25zID0gW10KICAgIGlmIG5vdCB0YWdzIGlzIE5vbmU6CiAgICAgICAgdGFnc0Zvcm1hdHRlZCA9IFtdCiAgICAgICAgZm9yIHQgaW4gdGFnczoKICAgICAgICAgICAgdGFnc0Zvcm1hdHRlZC5hcHBlbmQoeydLZXknOiB0LCAnVmFsdWUnOiB0YWdzW3RdfSkKICAgICAgICB0YWdTcGVjaWZpY2F0aW9ucy5hcHBlbmQoeydSZXNvdXJjZVR5cGUnOiAnaW5zdGFuY2UnLCAnVGFncyc6IHRhZ3NGb3JtYXR0ZWR9KQoKICAgIGluc3RhbmNlUHJvZmlsZSA9IHt9CiAgICBpZiBub3QgaWFtX3JvbGUgaXMgTm9uZToKICAgICAgICBpbnN0YW5jZVByb2ZpbGUgPSB7J0Fybic6ICcnLCAnTmFtZSc6IGlhbV9yb2xlfQoKICAgIGlmIG5vdCB2cGMgaXMgTm9uZToKICAgICAgICBlYzJjbGllbnQgPSBlYzIKICAgIGVsc2U6CiAgICAgICAgZWMyY2xpZW50ID0gZWMyLlN1Ym5ldCh2cGMpCiAgICBpbnN0YW5jZXMgPSBlYzJjbGllbnQuY3JlYXRlX2luc3RhbmNlcygKICAgICAgICBJbWFnZUlkPWFtaV9pZCwKICAgICAgICBNaW5Db3VudD1taW5jb3VudCwKICAgICAgICBNYXhDb3VudD1tYXhjb3VudCwKICAgICAgICBLZXlOYW1lPWtleV9wYWlyX25hbWUsCiAgICAgICAgU2VjdXJpdHlHcm91cElkcz1zZWN1cml0eV9ncm91cF9pZHMsCiAgICAgICAgVXNlckRhdGE9dXNlcl9kYXRhLAogICAgICAgIEluc3RhbmNlVHlwZT1pbnN0YW5jZV90eXBlLAogICAgICAgIFN1Ym5ldElkPXN1Ym5ldF9pZCwKICAgICAgICBUYWdTcGVjaWZpY2F0aW9ucz10YWdTcGVjaWZpY2F0aW9ucywKICAgICAgICBJYW1JbnN0YW5jZVByb2ZpbGU9aW5zdGFuY2VQcm9maWxlKQoKICAgIGlmIGluc3RhbmNlcyBpcyBOb25lOgogICAgICAgIHJldHVybiBGYWxzZSwgJ0Vycm9yIHJlc2VydmluZyBpbnN0YW5jZShzKScKCiAgICBpbnN0YW5jZXNfY3JlYXRlZCA9IFtdCiAgICBmb3IgaW5zdGFuY2UgaW4gaW5zdGFuY2VzOgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHJlcyA9IGdldF9pbnN0YW5jZV9zdGF0dXMoaW5zdGFuY2UuaW5zdGFuY2VfaWQpCiAgICAgICAgICAgIGlmIGxlbihyZXNbJ0luc3RhbmNlU3RhdHVzZXMnXSkgPCAxOgogICAgICAgICAgICAgICAgcHJpbnQoJy4uLndhaXRpbmcgZm9yICJ7fSIgc3RhdHVzJy5mb3JtYXQoaW5zdGFuY2UuaW5zdGFuY2VfaWQpKQogICAgICAgICAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEwKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc3RhdHVzID0gcmVzWydJbnN0YW5jZVN0YXR1c2VzJ11bMF0KICAgICAgICAgICAgaWYgc3RhdHVzWydJbnN0YW5jZVN0YXRlJ11bJ05hbWUnXSA9PSAncnVubmluZyc6CiAgICAgICAgICAgICAgICBwcmludCgnLi4uaW5zdGFuY2Uge30gaXMge30nLmZvcm1hdChpbnN0YW5jZS5pbnN0YW5jZV9pZCwgc3RhdHVzWydJbnN0YW5jZVN0YXRlJ11bJ05hbWUnXSkpCiAgICAgICAgICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0X2luc3RhbmNlX3N0YXR1cyhpbnN0YW5jZS5pbnN0YW5jZV9pZCkKICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocmVzWydJbnN0YW5jZVN0YXR1c2VzJ10pIDwgMToKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9zdGF0ZSA9IGVjMl9jbGllbnQuZGVzY3JpYmVfaW5zdGFuY2VzKEluc3RhbmNlSWRzPVtpbnN0YW5jZS5pbnN0YW5jZV9pZF0pWydSZXNlcnZhdGlvbnMnXVswXVsnSW5zdGFuY2VzJ11bMF1bJ1N0YXRlJ11bJ05hbWUnXQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3N0YXRlX3JlYXNvbiA9IGVjMl9jbGllbnQuZGVzY3JpYmVfaW5zdGFuY2VzKEluc3RhbmNlSWRzPVtpbnN0YW5jZS5pbnN0YW5jZV9pZF0pWydSZXNlcnZhdGlvbnMnXVswXVsnSW5zdGFuY2VzJ11bMF1bJ1N0YXRlUmVhc29uJ11bJ01lc3NhZ2UnXQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgnLi4uaW5zdGFuY2Uge30gaXMge30gLSB7fScuZm9ybWF0KGluc3RhbmNlLmluc3RhbmNlX2lkLCBjdXJyZW50X3N0YXRlLCBjdXJyZW50X3N0YXRlX3JlYXNvbikpCiAgICAgICAgICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHJlc1snSW5zdGFuY2VTdGF0dXNlcyddWzBdCiAgICAgICAgICAgICAgICAgICAgaWYgc3RhdHVzWydJbnN0YW5jZVN0YXR1cyddWydTdGF0dXMnXSA9PSAnb2snOgogICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXNfY3JlYXRlZC5hcHBlbmQoaW5zdGFuY2UuaW5zdGFuY2VfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCcuLi5pbnN0YW5jZSB7fSBpcyB7fScuZm9ybWF0KGluc3RhbmNlLmluc3RhbmNlX2lkLCBzdGF0dXNbJ0luc3RhbmNlU3RhdHVzJ11bJ1N0YXR1cyddKSkKICAgICAgICAgICAgICAgICAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxpZiBzdGF0dXNbJ0luc3RhbmNlU3RhdHVzJ11bJ1N0YXR1cyddID09ICdpbml0aWFsaXppbmcnOgogICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXNfY3JlYXRlZC5hcHBlbmQoaW5zdGFuY2UuaW5zdGFuY2VfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCcuLi5pbnN0YW5jZSB7fSBpcyB7fScuZm9ybWF0KGluc3RhbmNlLmluc3RhbmNlX2lkLCBzdGF0dXNbJ0luc3RhbmNlU3RhdHVzJ11bJ1N0YXR1cyddKSkKICAgICAgICAgICAgICAgICAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoJy4uLmluc3RhbmNlIHt9IGlzIHt9Jy5mb3JtYXQoaW5zdGFuY2UuaW5zdGFuY2VfaWQsIHN0YXR1c1snSW5zdGFuY2VTdGF0dXMnXVsnU3RhdHVzJ10pKQogICAgICAgICAgICAgICAgICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVsaWYgc3RhdHVzWydJbnN0YW5jZVN0YXRlJ11bJ05hbWUnXSA9PSAncGVuZGluZyc6CiAgICAgICAgICAgICAgICBwcmludCgnLi4uaW5zdGFuY2Uge30gaXMge30nLmZvcm1hdChpbnN0YW5jZS5pbnN0YW5jZV9pZCwgc3RhdHVzWydJbnN0YW5jZVN0YXRlJ11bJ05hbWUnXSkpICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxMCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCcuLi5pbnN0YW5jZSB7fSBpcyB7fSAtIHt9Jy5mb3JtYXQoaW5zdGFuY2UuaW5zdGFuY2VfaWQsIHN0YXR1c1snSW5zdGFuY2VTdGF0ZSddWydOYW1lJ10sIGluc3RhbmNlLnN0YXRlX3JlYXNvbi5NZXNzYWdlKSkKICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgICAgICAgICAgYnJlYWsKCiAgICBpZiBsZW4oaW5zdGFuY2VzX2NyZWF0ZWQpID4gMDoKICAgICAgICBwcmludCgnTGF1bmNoZWQge30gZWMyIHt9IGluc3RhbmNlKHMpIFt7fV0nLmZvcm1hdChsZW4oaW5zdGFuY2VzX2NyZWF0ZWQpLCBpbnN0YW5jZV90eXBlLCAnLCcuam9pbihpbnN0YW5jZXNfY3JlYXRlZCkpKQogICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIHJldHVybiBUcnVlLCBpbnN0YW5jZXNfY3JlYXRlZAogICAgZWxzZToKICAgICAgICBwcmludCgnRmFpbGVkIHRvIGxhdW5jaCBhbnkgZWMyIGluc3RhbmNlcycpCiAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgcmV0dXJuIEZhbHNlLCAnRmFpbGVkIHRvIGxhdW5jaCBhbnkgZWMyIGluc3RhbmNlcycKCgpkZWYgdGVybWluYXRlX2VjMl9pbnN0YW5jZXMoaW5zdGFuY2VzKToKICAgIHByaW50KCdUZXJtaW5hdGluZyBlYzIgaW5zdGFuY2VzIFt7MH1dJy5mb3JtYXQoJywnLmpvaW4oaW5zdGFuY2VzKSkpCiAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgIGVjMl9jbGllbnQudGVybWluYXRlX2luc3RhbmNlcyhJbnN0YW5jZUlkcz1pbnN0YW5jZXMpCiAgICB3YWl0ZXIgPSBlYzJfY2xpZW50LmdldF93YWl0ZXIoJ2luc3RhbmNlX3Rlcm1pbmF0ZWQnKQogICAgd2FpdGVyLndhaXQoSW5zdGFuY2VJZHM9aW5zdGFuY2VzKQogICAgcHJpbnQoJ2VjMiBpbnN0YW5jZXMgdGVybWluYXRlZCBbezB9XScuZm9ybWF0KCcsJy5qb2luKGluc3RhbmNlcykpKQogICAgc3lzLnN0ZG91dC5mbHVzaCgpCgoKZGVmIHN0YXJ0X2VjMl9pbnN0YW5jZXMoaW5zdGFuY2VzKToKICAgIHByaW50KCdTdGFydGluZyBlYzIgaW5zdGFuY2VzIFt7MH1dJy5mb3JtYXQoJywnLmpvaW4oaW5zdGFuY2VzKSkpCiAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgIGVjMl9jbGllbnQuc3RhcnRfaW5zdGFuY2VzKEluc3RhbmNlSWRzPWluc3RhbmNlcykKICAgIHdhaXRlciA9IGVjMl9jbGllbnQuZ2V0X3dhaXRlcignaW5zdGFuY2VfcnVubmluZycpCiAgICB3YWl0ZXIud2FpdChJbnN0YW5jZUlkcz1pbnN0YW5jZXMpCiAgICBwcmludCgnZWMyIGluc3RhbmNlcyBydW5uaW5nIFt7MH1dJy5mb3JtYXQoJywnLmpvaW4oaW5zdGFuY2VzKSkpCiAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKCgpkZWYgc3RvcF9lYzJfaW5zdGFuY2VzKGluc3RhbmNlcyk6CiAgICBwcmludCgnU3RvcHBpbmcgZWMyIGluc3RhbmNlcyBbezB9XScuZm9ybWF0KCcsJy5qb2luKGluc3RhbmNlcykpKQogICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICBlYzJfY2xpZW50LnN0b3BfaW5zdGFuY2VzKEluc3RhbmNlSWRzPWluc3RhbmNlcykKICAgIHdhaXRlciA9IGVjMl9jbGllbnQuZ2V0X3dhaXRlcignaW5zdGFuY2Vfc3RvcHBlZCcpCiAgICB3YWl0ZXIud2FpdChJbnN0YW5jZUlkcz1pbnN0YW5jZXMpCiAgICBwcmludCgnZWMyIGluc3RhbmNlcyBzdG9wcGVkIFt7MH1dJy5mb3JtYXQoJywnLmpvaW4oaW5zdGFuY2VzKSkpCiAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKCgpkZWYgdGVybWluYXRlX2ltcGFpcmVkX2VjMl9pbnN0YW5jZXNfd2l0aF90YWdzKHRhZ3MpOgogICAgaW5zdGFuY2VfaWRzID0gZ2V0X2luc3RhbmNlX2lkc193aXRoX2ZpbHRlcih0YWdzLCBbJ3BlbmRpbmcnLCAncnVubmluZyddKQoKICAgIGltcGFpcmVkX2luc3RhbmNlcyA9IFtdCiAgICByZXMgPSBlYzJfY2xpZW50LmRlc2NyaWJlX2luc3RhbmNlX3N0YXR1cyhJbnN0YW5jZUlkcz1pbnN0YW5jZV9pZHMpCgogICAgZm9yIGluc3RhbmNlX3N0YXR1cyBpbiByZXNbJ0luc3RhbmNlU3RhdHVzZXMnXToKICAgICAgICBpZiBpbnN0YW5jZV9zdGF0dXNbJ0luc3RhbmNlU3RhdGUnXVsnTmFtZSddIGluIFsncGVuZGluZycsICdydW5uaW5nJ106CiAgICAgICAgICAgIGlmIGluc3RhbmNlX3N0YXR1c1snSW5zdGFuY2VTdGF0dXMnXVsnU3RhdHVzJ10gPT0gJ2ltcGFpcmVkJzoKICAgICAgICAgICAgICAgIGltcGFpcmVkX2luc3RhbmNlcy5hcHBlbmQoaW5zdGFuY2Vfc3RhdHVzWydJbnN0YW5jZUlkJ10pCgogICAgaWYgbGVuKGltcGFpcmVkX2luc3RhbmNlcykgPiAwOgogICAgICAgIHRlcm1pbmF0ZV9lYzJfaW5zdGFuY2VzKGltcGFpcmVkX2luc3RhbmNlcykKCiAgICByZXR1cm4gaW1wYWlyZWRfaW5zdGFuY2VzCgoKZGVmIGdldF9ydW5uaW5nX2luc3RhbmNlc193aXRoX3RhZ3ModGFncyk6CiAgICBpbnN0YW5jZV9pZHMgPSBnZXRfaW5zdGFuY2VfaWRzX3dpdGhfZmlsdGVyKHRhZ3MsIFsncGVuZGluZycsICdydW5uaW5nJ10pCiAgICBpZiBsZW4oaW5zdGFuY2VfaWRzKSA8IDE6CiAgICAgICAgcmV0dXJuIFtdCgogICAgcnVubmluZ19pbnN0YW5jZXMgPSBbXQogICAgcmVzID0gZWMyX2NsaWVudC5kZXNjcmliZV9pbnN0YW5jZV9zdGF0dXMoSW5zdGFuY2VJZHM9aW5zdGFuY2VfaWRzKQoKICAgIGZvciBpbnN0YW5jZV9zdGF0dXMgaW4gcmVzWydJbnN0YW5jZVN0YXR1c2VzJ106CiAgICAgICAgaWYgaW5zdGFuY2Vfc3RhdHVzWydJbnN0YW5jZVN0YXRlJ11bJ05hbWUnXSBpbiBbJ3BlbmRpbmcnLCAncnVubmluZyddOgogICAgICAgICAgICBpZiBpbnN0YW5jZV9zdGF0dXNbJ0luc3RhbmNlU3RhdHVzJ11bJ1N0YXR1cyddIGluIFsnb2snLCAnaW5pdGlhbGl6aW5nJ106CiAgICAgICAgICAgICAgICBydW5uaW5nX2luc3RhbmNlcy5hcHBlbmQoaW5zdGFuY2Vfc3RhdHVzWydJbnN0YW5jZUlkJ10pCgogICAgcmV0dXJuIHJ1bm5pbmdfaW5zdGFuY2VzCgoKIiIiCmFyZ3VtZW50czogc3RhdHVzID0gYXJyYXkgb2Ygc3RhdHVzZXMgdG8gaW5jbHVkZSwgZS5nLiBbJ3J1bm5pbmcnXQoiIiIKZGVmIGdldF9pbnN0YW5jZV9pZHNfd2l0aF9maWx0ZXIodGFncywgc3RhdHVzKToKICAgIGZpbHRlcnMgPSBbeydOYW1lJzogJ2luc3RhbmNlLXN0YXRlLW5hbWUnLCAnVmFsdWVzJzogc3RhdHVzfV0KICAgIGZvciB0IGluIHRhZ3M6CiAgICAgICAga2V5TmFtZSA9ICd0YWc6e30nLmZvcm1hdCh0KQogICAgICAgIGZpbHRlcnMuYXBwZW5kKHsnTmFtZSc6IGtleU5hbWUsICdWYWx1ZXMnOiBbdGFnc1t0XV19KQogICAgCiAgICByZXMgPSBlYzIuaW5zdGFuY2VzLmZpbHRlcihGaWx0ZXJzPWZpbHRlcnMpCgogICAgaW5zdGFuY2VfaWRzID0gW10KICAgIGZvciBpIGluIHJlczoKICAgICAgICBpbnN0YW5jZV9pZHMuYXBwZW5kKGkuaWQpCgogICAgcmV0dXJuIGluc3RhbmNlX2lkcwoKCmRlZiBnZXRfaW5zdGFuY2Vfc3RhdHVzKGluc3RhbmNlX2lkKToKICAgIHJldHVybiBlYzJfY2xpZW50LmRlc2NyaWJlX2luc3RhbmNlX3N0YXR1cyhJbnN0YW5jZUlkcz1baW5zdGFuY2VfaWRdKQoKCmRlZiBnZXRfaW5zdGFuY2UoaW5zdGFuY2VfaWQpOgogICAgcmV0dXJuIGVjMl9jbGllbnQuZGVzY3JpYmVfaW5zdGFuY2VzKEluc3RhbmNlSWRzPVtpbnN0YW5jZV9pZF0pCgoKZGVmIGdldF9ob3N0X2luc3RhbmNlX2lkKCk6CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgnaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2luc3RhbmNlLWlkJykKICAgIHJldHVybiByZXNwb25zZS50ZXh0CgoKZGVmIGdldF90YWdfdmFsdWUoaW5zdGFuY2VfaWQsIG5hbWUpOgogICAgdGFnX3ZhbHVlID0gTm9uZQogICAgaW5zdGFuY2UgPSBlYzIuSW5zdGFuY2UoaW5zdGFuY2VfaWQpCiAgICBmb3IgdGFnIGluIGluc3RhbmNlLnRhZ3M6CiAgICAgICAgaWYgdGFnWydLZXknXSA9PSBuYW1lOgogICAgICAgICAgICB0YWdfdmFsdWUgPSB0YWdbJ1ZhbHVlJ10KICAgICAgICAgICAgYnJlYWsKICAgIHJldHVybiB0YWdfdmFsdWUKCgpkZWYgZ2V0X251bV9ydW5uaW5nX3BlbmRpbmdfaW5zdGFuY2VzKHRhZ3MpOgogICAgZmlsdGVycyA9IFt7J05hbWUnOiAnaW5zdGFuY2Utc3RhdGUtbmFtZScsICdWYWx1ZXMnOiBbJ3J1bm5pbmcnLCAncGVuZGluZyddfV0KICAgIGZvciB0IGluIHRhZ3M6CiAgICAgICAga2V5TmFtZSA9ICd0YWc6e30nLmZvcm1hdCh0KQogICAgICAgIGZpbHRlcnMuYXBwZW5kKHsnTmFtZSc6IGtleU5hbWUsICdWYWx1ZXMnOiBbdGFnc1t0XV19KQoKICAgIGluc3RhbmNlcyA9IGVjMi5pbnN0YW5jZXMuZmlsdGVyKEZpbHRlcnM9ZmlsdGVycykKICAgIHJldHVybiBsZW4oaW5zdGFuY2VzKQogICAgIyBmb3IgaW5zdGFuY2UgaW4gaW5zdGFuY2VzOgogICAgIyAgICAgcHJpbnQoaW5zdGFuY2UuaWQsIGluc3RhbmNlLmluc3RhbmNlX3R5cGUpCg==","teamUsable":true,"teamEditable":true,"isActive":true}]}